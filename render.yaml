services:
  # Backend Web Service (Docker)
  - type: web
    name: googleads-dashboard-backend
    runtime: docker
    rootDir: backend
    plan: free
    region: singapore # Closest to user (India) usually
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: googleads-db
          property: connectionString
      - key: APP_ENV
        value: production
      - key: DEBUG
        value: "false"
      - key: SECRET_KEY
        generateValue: true
      # You must verify these in the Render Dashboard after creation
      - key: GOOGLE_ADS_REFRESH_TOKEN
        sync: false
      - key: GOOGLE_ADS_CLIENT_ID
        sync: false
      - key: GOOGLE_ADS_CLIENT_SECRET
        sync: false
      - key: GOOGLE_ADS_DEVELOPER_TOKEN
        sync: false
      - key: GOOGLE_ADS_LOGIN_CUSTOMER_ID
        sync: false
      - key: FRONTEND_URL
        value: "https://googleadsdashboard-beta.vercel.app"
      # Telegram Bot Configuration (for FREE spike alerts)
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false
      - key: SPIKE_THRESHOLD_PERCENT
        value: "20"

databases:
  # Managed PostgreSQL
  - name: googleads-db
    databaseName: tellspike
    user: tellspike
    plan: free
    region: singapore
  # Optional: Redis if we need it for caching later
  # - type: redis
  #   name: googleads-cache
  #   plan: free

  # -----------------------------------------------------------------------
  # Cron Job: Auto-Sync Data every 12 hours
  # Keep backend fresh even if the web service sleeps
  # -----------------------------------------------------------------------
  - type: cron
    name: googleads-data-sync
    runtime: docker
    rootDir: backend
    region: singapore
    schedule: "0 */12 * * *" # Every 12 hours
    plan: free
    dockerCommand: python run_auto_sync.py
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: googleads-db
          property: connectionString
      - key: GOOGLE_ADS_REFRESH_TOKEN
        sync: false
      - key: GOOGLE_ADS_CLIENT_ID
        sync: false
      - key: GOOGLE_ADS_CLIENT_SECRET
        sync: false
      - key: GOOGLE_ADS_DEVELOPER_TOKEN
        sync: false
      - key: GOOGLE_ADS_LOGIN_CUSTOMER_ID
        sync: false
